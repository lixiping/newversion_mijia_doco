{"version":3,"sources":["../src/AnimatedData.js"],"names":["isAnimated","require","Animated","__getValue","AnimatedWithChildren","_children","child","length","__attach","push","index","indexOf","console","warn","splice","__detach","AnimatedUniforms","uniforms","_uniforms","u","key","value","Array","arr","i","v","__addChild","__removeChild","AnimatedData","data","callback","_data","contextChildren","map","d","children","update","width","height","c","forEach","module","exports"],"mappings":";;;;;;;;;;;;;;AAAA,IAAMA,aAAaC,QAAQ,cAAR,CAAnB;;AAEA;;IAEMC,Q;;;;;;;+BACO,CAAE;;;+BACF,CAAE;;;iCACA,CAAE;;;yCACM;AACnB,aAAO,KAAKC,UAAL,EAAP;AACD;;;iCACY,CAAE;;;oCACC,CAAE;;;oCACF;AACd,aAAO,EAAP;AACD;;;;;;IAGGC,oB;;;AACJ,kCAAc;AAAA;;AAAA;;AAEZ,UAAKC,SAAL,GAAiB,EAAjB;AAFY;AAGb;;;;+BACUC,K,EAAO;AAChB,UAAI,KAAKD,SAAL,CAAeE,MAAf,KAA0B,CAA9B,EAAiC;AAC/B,aAAKC,QAAL;AACD;AACD,WAAKH,SAAL,CAAeI,IAAf,CAAoBH,KAApB;AACD;;;kCACaA,K,EAAO;AACnB,UAAII,QAAQ,KAAKL,SAAL,CAAeM,OAAf,CAAuBL,KAAvB,CAAZ;AACA,UAAII,UAAU,CAAC,CAAf,EAAkB;AAChBE,gBAAQC,IAAR,CAAa,6CAAb;AACA;AACD;AACD,WAAKR,SAAL,CAAeS,MAAf,CAAsBJ,KAAtB,EAA6B,CAA7B;AACA,UAAI,KAAKL,SAAL,CAAeE,MAAf,KAA0B,CAA9B,EAAiC;AAC/B,aAAKQ,QAAL;AACD;AACF;;;oCACe;AACd,aAAO,KAAKV,SAAZ;AACD;;;;EAxBgCH,Q;;AA2BnC;;;IACMc,gB;;;AACJ,4BAAYC,QAAZ,EAAsB;AAAA;;AAAA;;AAEpB,WAAKC,SAAL,GAAiBD,QAAjB;AACA,WAAKT,QAAL;AAHoB;AAIrB;;;;iCAEY;AACX,UAAMW,IAAI,EAAV;AACA,UAAMF,WAAW,KAAKC,SAAtB;AACA,WAAK,IAAIE,GAAT,IAAgBH,QAAhB,EAA0B;AACxB,YAAII,QAAQJ,SAASG,GAAT,CAAZ;AACA,YAAIC,iBAAiBC,KAArB,EAA4B;AAC1B,cAAIC,MAAM,EAAV;AACA,eAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,MAAMd,MAA1B,EAAkCiB,GAAlC,EAAuC;AACrC,gBAAIC,IAAIJ,MAAMG,CAAN,CAAR;AACAD,gBAAIC,CAAJ,IAASxB,WAAWyB,CAAX,IAAgBA,EAAEtB,UAAF,EAAhB,GAAiCsB,CAA1C;AACD;AACDN,YAAEC,GAAF,IAASG,GAAT;AACD,SAPD,MAOO,IAAIvB,WAAWqB,KAAX,CAAJ,EAAuB;AAC5BF,YAAEC,GAAF,IAASC,MAAMlB,UAAN,EAAT;AACD,SAFM,MAEA;AACLgB,YAAEC,GAAF,IAASC,KAAT;AACD;AACF;AACD,aAAOF,CAAP;AACD;;;+BAEU;AACT,UAAMF,WAAW,KAAKC,SAAtB;AACA,WAAK,IAAIE,GAAT,IAAgBH,QAAhB,EAA0B;AACxB,YAAII,QAAQJ,SAASG,GAAT,CAAZ;AACA,YAAIC,iBAAiBC,KAArB,EAA4B;AAC1B,eAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAIH,MAAMd,MAA1B,EAAkCiB,GAAlC,EAAuC;AACrC,gBAAIC,IAAIJ,MAAMG,CAAN,CAAR;AACA,gBAAIxB,WAAWyB,CAAX,CAAJ,EAAmB;AACjBA,gBAAEC,UAAF,CAAa,IAAb;AACD;AACF;AACF,SAPD,MAOO,IAAI1B,WAAWqB,KAAX,CAAJ,EAAuB;AAC5BA,gBAAMK,UAAN,CAAiB,IAAjB;AACD;AACF;AACF;;;+BAEU;AACT,UAAMT,WAAW,KAAKC,SAAtB;AACA,WAAK,IAAIE,GAAT,IAAgBH,QAAhB,EAA0B;AACxB,YAAII,QAAQJ,SAASG,GAAT,CAAZ;AACA,YAAIC,iBAAiBC,KAArB,EAA4B;AAC1B,eAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAIH,MAAMd,MAA1B,EAAkCiB,GAAlC,EAAuC;AACrC,gBAAIC,IAAIJ,MAAMG,CAAN,CAAR;AACA,gBAAIxB,WAAWyB,CAAX,CAAJ,EAAmB;AACjBA,gBAAEE,aAAF,CAAgB,IAAhB;AACD;AACF;AACF,SAPD,MAOO,IAAI3B,WAAWqB,KAAX,CAAJ,EAAuB;AAC5BA,gBAAMM,aAAN,CAAoB,IAApB;AACD;AACF;AACF;;;;EA5D4BvB,oB;;AA+D/B;;;IACMwB,Y;;;AACJ,wBAAYC,IAAZ,EAAkBC,QAAlB,EAA4B;AAAA;;AAAA;;AAE1B,WAAKC,KAAL,gBACKF,IADL;AAEEG,uBAAiBH,KAAKG,eAAL,CAAqBC,GAArB,CAAyB;AAAA,eAAK,IAAIL,YAAJ,CAAiBM,CAAjB,CAAL;AAAA,OAAzB,CAFnB;AAGEC,gBAAUN,KAAKM,QAAL,CAAcF,GAAd,CAAkB;AAAA,eAAK,IAAIL,YAAJ,CAAiBM,CAAjB,CAAL;AAAA,OAAlB,CAHZ;AAIEjB,gBAAU,IAAID,gBAAJ,CAAqBa,KAAKZ,QAA1B;AAJZ;AAMA,QAAIa,QAAJ,EAAc,OAAKM,MAAL,GAAcN,QAAd;AACd,WAAKtB,QAAL;AAT0B;AAU3B;;;;iCAEY;AAAA,kBAQP,KAAKuB,KARE;AAAA,UAETC,eAFS,SAETA,eAFS;AAAA,UAGTK,KAHS,SAGTA,KAHS;AAAA,UAITC,MAJS,SAITA,MAJS;AAAA,UAKTH,QALS,SAKTA,QALS;AAAA,UAMTlB,QANS,SAMTA,QANS;AAAA,UAONY,IAPM;;AASXA,WAAKQ,KAAL,GAAarC,WAAWqC,KAAX,IAAoBA,MAAMlC,UAAN,EAApB,GAAyCkC,KAAtD;AACAR,WAAKS,MAAL,GAActC,WAAWsC,MAAX,IAAqBA,OAAOnC,UAAP,EAArB,GAA2CmC,MAAzD;AACAT,WAAKG,eAAL,GAAuBA,gBAAgBC,GAAhB,CAAoB;AAAA,eAAKM,EAAEpC,UAAF,EAAL;AAAA,OAApB,CAAvB;AACA0B,WAAKM,QAAL,GAAgBA,SAASF,GAAT,CAAa;AAAA,eAAKM,EAAEpC,UAAF,EAAL;AAAA,OAAb,CAAhB;AACA0B,WAAKZ,QAAL,GAAgBA,SAASd,UAAT,EAAhB;AACA,aAAO0B,IAAP;AACD;;;+BAEU;AAAA;;AAAA,mBACsD,KAAKE,KAD3D;AAAA,UACDC,eADC,UACDA,eADC;AAAA,UACgBG,QADhB,UACgBA,QADhB;AAAA,UAC0BlB,QAD1B,UAC0BA,QAD1B;AAAA,UACoCoB,KADpC,UACoCA,KADpC;AAAA,UAC2CC,MAD3C,UAC2CA,MAD3C;;AAET,UAAItC,WAAWqC,KAAX,CAAJ,EAAuBA,MAAMX,UAAN,CAAiB,IAAjB;AACvB,UAAI1B,WAAWsC,MAAX,CAAJ,EAAwBA,OAAOZ,UAAP,CAAkB,IAAlB;AACxBM,sBAAgBQ,OAAhB,CAAwB;AAAA,eAAKD,EAAEb,UAAF,QAAL;AAAA,OAAxB;AACAS,eAASK,OAAT,CAAiB;AAAA,eAAKD,EAAEb,UAAF,QAAL;AAAA,OAAjB;AACAT,eAASS,UAAT,CAAoB,IAApB;AACD;;;+BAEU;AAAA;;AAAA,mBACsD,KAAKK,KAD3D;AAAA,UACDC,eADC,UACDA,eADC;AAAA,UACgBG,QADhB,UACgBA,QADhB;AAAA,UAC0BlB,QAD1B,UAC0BA,QAD1B;AAAA,UACoCoB,KADpC,UACoCA,KADpC;AAAA,UAC2CC,MAD3C,UAC2CA,MAD3C;;AAET,UAAItC,WAAWqC,KAAX,CAAJ,EAAuBA,MAAMV,aAAN,CAAoB,IAApB;AACvB,UAAI3B,WAAWsC,MAAX,CAAJ,EAAwBA,OAAOX,aAAP,CAAqB,IAArB;AACxBK,sBAAgBQ,OAAhB,CAAwB;AAAA,eAAKD,EAAEZ,aAAF,QAAL;AAAA,OAAxB;AACAQ,eAASK,OAAT,CAAiB;AAAA,eAAKD,EAAEZ,aAAF,QAAL;AAAA,OAAjB;AACAV,eAASU,aAAT,CAAuB,IAAvB;AACD;;;;EA9CwBvB,oB;;AAiD3BqC,OAAOC,OAAP,GAAiBd,YAAjB","file":"AnimatedData.js","sourcesContent":["const isAnimated = require(\"./isAnimated\");\n\n// At the moment, need to dup some things from RN Animated\n\nclass Animated {\n  __attach() {}\n  __detach() {}\n  __getValue() {}\n  __getAnimatedValue() {\n    return this.__getValue();\n  }\n  __addChild() {}\n  __removeChild() {}\n  __getChildren() {\n    return [];\n  }\n}\n\nclass AnimatedWithChildren extends Animated {\n  constructor() {\n    super();\n    this._children = [];\n  }\n  __addChild(child) {\n    if (this._children.length === 0) {\n      this.__attach();\n    }\n    this._children.push(child);\n  }\n  __removeChild(child) {\n    var index = this._children.indexOf(child);\n    if (index === -1) {\n      console.warn(\"Trying to remove a child that doesn't exist\");\n      return;\n    }\n    this._children.splice(index, 1);\n    if (this._children.length === 0) {\n      this.__detach();\n    }\n  }\n  __getChildren() {\n    return this._children;\n  }\n}\n\n// Animated over the GL Data uniforms object\nclass AnimatedUniforms extends AnimatedWithChildren {\n  constructor(uniforms) {\n    super();\n    this._uniforms = uniforms;\n    this.__attach();\n  }\n\n  __getValue() {\n    const u = {};\n    const uniforms = this._uniforms;\n    for (let key in uniforms) {\n      let value = uniforms[key];\n      if (value instanceof Array) {\n        let arr = [];\n        for (let i = 0; i < value.length; i++) {\n          let v = value[i];\n          arr[i] = isAnimated(v) ? v.__getValue() : v;\n        }\n        u[key] = arr;\n      } else if (isAnimated(value)) {\n        u[key] = value.__getValue();\n      } else {\n        u[key] = value;\n      }\n    }\n    return u;\n  }\n\n  __attach() {\n    const uniforms = this._uniforms;\n    for (let key in uniforms) {\n      let value = uniforms[key];\n      if (value instanceof Array) {\n        for (let i = 0; i < value.length; i++) {\n          let v = value[i];\n          if (isAnimated(v)) {\n            v.__addChild(this);\n          }\n        }\n      } else if (isAnimated(value)) {\n        value.__addChild(this);\n      }\n    }\n  }\n\n  __detach() {\n    const uniforms = this._uniforms;\n    for (let key in uniforms) {\n      let value = uniforms[key];\n      if (value instanceof Array) {\n        for (let i = 0; i < value.length; i++) {\n          let v = value[i];\n          if (isAnimated(v)) {\n            v.__removeChild(this);\n          }\n        }\n      } else if (isAnimated(value)) {\n        value.__removeChild(this);\n      }\n    }\n  }\n}\n\n// Animated over a GL Data\nclass AnimatedData extends AnimatedWithChildren {\n  constructor(data, callback) {\n    super();\n    this._data = {\n      ...data,\n      contextChildren: data.contextChildren.map(d => new AnimatedData(d)),\n      children: data.children.map(d => new AnimatedData(d)),\n      uniforms: new AnimatedUniforms(data.uniforms)\n    };\n    if (callback) this.update = callback;\n    this.__attach();\n  }\n\n  __getValue() {\n    const {\n      contextChildren,\n      width,\n      height,\n      children,\n      uniforms,\n      ...data\n    } = this._data;\n    data.width = isAnimated(width) ? width.__getValue() : width;\n    data.height = isAnimated(height) ? height.__getValue() : height;\n    data.contextChildren = contextChildren.map(c => c.__getValue());\n    data.children = children.map(c => c.__getValue());\n    data.uniforms = uniforms.__getValue();\n    return data;\n  }\n\n  __attach() {\n    const { contextChildren, children, uniforms, width, height } = this._data;\n    if (isAnimated(width)) width.__addChild(this);\n    if (isAnimated(height)) height.__addChild(this);\n    contextChildren.forEach(c => c.__addChild(this));\n    children.forEach(c => c.__addChild(this));\n    uniforms.__addChild(this);\n  }\n\n  __detach() {\n    const { contextChildren, children, uniforms, width, height } = this._data;\n    if (isAnimated(width)) width.__removeChild(this);\n    if (isAnimated(height)) height.__removeChild(this);\n    contextChildren.forEach(c => c.__removeChild(this));\n    children.forEach(c => c.__removeChild(this));\n    uniforms.__removeChild(this);\n  }\n}\n\nmodule.exports = AnimatedData;\n"]}